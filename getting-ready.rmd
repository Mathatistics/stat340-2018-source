# Getting Started

```{r, include = FALSE}
knitr::opts_chunk$set(eval = eval)
eval <- TRUE
ans <- TRUE
```

We will use a dataset containing body measures of about 400 persons as an example set to practice our RStudio skills.

## Create New Project
Creating a project allows us to organize the files and related materials duing our study. File => New Project opens a window to create new project. It will be easier to access all the resources, if all the scripts and datasets are within a main folder, i.e. the project folder.

```{r, echo = FALSE, purl = FALSE}
library(htmltools)
div(class = "screenshot", style = "display:none",
    div(class = "img-row",
        div(class = "screenshot-img",
            img(src = "images/NewProject-1.png",
                alg = "NewProject",
                width = "30%",
                class = "left")
            ),
        div(class = "screenshot-img",
            img(src = "images/NewProject-2.png",
                alg = "NewProject",
                width = "48%",
                class = "left")
            )
        ),
    div(class = "img-row",
        div(class = "screenshot-img",
            img(src = "images/NewProject-3.png",
                alg = "NewProject",
                width = "48%",
                class = "left")
            ),
        div(class = "screenshot-img",
            img(src = "images/NewProject-4.png",
                alg = "NewProject",
                width = "48%",
                class = "left")
            )
        )
    )
```

## Exercise 1: Data Import
### Import from Rdata-file (Workspace file)
Download the data set files "`bodydata.rdata`", "`bodydata.txt`" and "`bodydata.xlsx`" from the fronter pages and save them into your project folder. The files should then be visible under the "files" tab in the bottom-right window in RStudio. A `rdata`-file can be loaded into the workspace either by option 1, 2 or 3 below:

1) Clicking on the filename in the lower right window and answer "yes" to import the data.
2)  Clicking the "Open folder icon" under the environment tab in the upper right window. This opens the "Load workspace" dialogue. Locate the data file to load.
3)  Load by executing the command (the file must be located in the working directory)

```{r}
load(file = "bodydata.rdata")
```

You can change your working directory from main menu "Session > Set working directory" <strong>if needed</strong>. Any of the above should result in an object called bodydata to appear in the list under "Environment" in the upper right window. This is a data.frame with 407 observations (rows) and 4 variables (columns)

### Reading data from `txt` - file
A table of data can be read into an object, here named "`bodydata.from.txt`" from txt-file "`bodydata.txt`" by:

```{r}
bodydata.from.txt <- read.table(file = "bodydata.txt", 
                                header = TRUE, dec = ",")
```

Read the help-file for `read.table` for explanation of extra arguments  such as `dec`, `sep` and `header`. Type `?read.table` in console and press return (enter) to access the help or type the name of command, here `data.table` in the search fild of help tab. 

### Reading data from clipboard ("pasting" copied data into an R object)
You can open the excel-file bodydata.xlsx and copy all variables first, then run:

```{r, eval = FALSE}
bodydata <- read.table(file = "clipboard", header = TRUE)
```

In Mac, you need to do,

```{r, eval = FALSE}
bodydata <- read.table(file = pipe("pbpaste"), header = TRUE)
```

This allows us to get the data from anywhere just after they are copied.

## Exercise 2 - Export data to a file
To export an r-object to a file, `write.table` function is used.

### Write to txt-file:

```{r, eval = FALSE}
write.table(bodydata, file = "bodydata.txt", row.names = F, quote = F)
```

### Write to memory (copy data)

```{r, eval = FALSE}
write.table(bodydata, file = "clipboard", 
            row.names = F, quote = F, dec = ",", 
            sep = "\t")
```

This will copy the data in r-object on to clipboard which can be pasted anywhere. These data can be directly pasted into an excel-file to create a table.

### Save objects as Rdata-file:
Rdata-file allows to save multiple r objects in a file with extension `.rdata`.

```{r, eval = FALSE}
save(bodydata, file = "bodydata2.rdata")
```

This will export bodydata object to a file named `bodydata2.rdata` on your working directory.

## Exercise 3 - Exploring the data
### Take a look at the top 5 rows of the data

```{r}
head(bodydata, 5)
```

### Take a look at selected rows and column of the data

```{r}
bodydata[1:5, c(1, 3)]
```

Here, the `1:5` refers to the number of rows and `c(1, 3)`refers to the number of columns  you want from `bodydata`. The output contains the 1 to 5 rows and first and third column for `bodydata`.


### Check the dimensions of the data

```{r}
dim(bodydata)
```

Here, the first and second item refers to the number of rows and number of columns of bodydata. Similarly, we can use `nrow(bodydata)` and `ncol(bodydata)`to obtain these number individually.

### Summary of the data using `summary()` function

```{r}
summary(bodydata)
```


### The `attach` function
Try to look at the weights by writing Weight and press return. What happens?

```{r eval=FALSE}
Weight
```

Here you will get a <span style = "color:red">ERROR</span> saying that R could not find `Weight` on your workspace.

Attach the data, and try again,

```{r}
attach(bodydata)
Weight
```

Attach makes the variables "visible" from outside the data frame. The opposite function is `detach()`. After attaching a data frame, R can access its variables just like another R object.

## Exercise 4 - Subsets of data and logical operators
We can perform logical test and get `TRUE` or `FALSE` as result. Make a variable called `isHeavy` by,

```{r}
isHeavy <- Weight > 80
```

#### Take a look at this variable, what is it?

```{r}
head(isHeavy)
```

Yes, it is a vector of `TRUE` and `FALSE` with same length as `Weight`. Here the condition has compared each element of `Weight` results `TRUE` if  it is greater than 80 and `FALSE` if it is less than 80.

#### Identify the elements
We can identify which observations that are heavy by the `which()` function

```{r}
HeavyId <- which(isHeavy)
```

#### How many are heavy?

```{r, echo=ans, eval=ans}
length(HeavyId)
```

In the similar manner, identify who are taller than 180 and  save this as an object called `isTall`.

```{r, echo=ans}
isTall <- Height > 180 
```

Here, you can use `length` function as above to find how many person are taller than 180.

#### Try 

```{r}
isBoth <- isHeavy * isTall
```

#### How is this computation done?

Here `isHeavy` and `isTall` contains `TRUE` and `FALSE`. The multiplication of logical operator results a logical vector with `TRUE` only if both the vectors are `TRUE` else `FALSE`.

#### Alternatively

```{r}
isBoth <- which(isHeavy & isTall)
```

The `&` operator result `TRUE` if both `isHeavy` and `isTall` are `TRUE` else, `FALSE` which is same as previous.

### Subsetting data frame
Create a subset of the data called `bodydataTallAndHeavy` containing only the observations for tall and heavy persons as defined by isBoth.

```{r, echo=ans}
bodydataTallAndHeavy <- bodydata[isBoth, ]
```

For other logical tests see help file `?Comparison`

Create a random subset of 50 observations by 

1) sampling a vector of random observation numbers using the `sample()` function, and then
    
```{r}
idx <- sample(nrow(bodydata), 50)
```

Here, 50 rows are sampled from the total number of rows and the index of the selected rows are saved on vector `idx`.

2) using the vector to select the rows to create a new data set called `bodydataRandom`.
    
```{r, echo=ans}
bodydataRandom <- bodydata[idx, ]
```


## Exercise 5 - Graphics

#### Plot the heights versus the weights for all observations in bodydata.

```{r, echo=ans, eval=ans}
plot(x = Height, y = Weight)
```

### Spice up the plot
Check out the presentation for lesson 1 to see how to spice up the plot

#### Explore the `?par` help file

Use the `isBoth` variable to create a color vector

```{r}
mycolors <- ifelse((isHeavy & isTall), "blue", "red")
```

Here, `isHeady & isTall` returns a logical vector. The `ifelse` function returns `blue` if `TRUE`and `red` if `FALSE` for each elements of the logical vector. The colors are then used in the plot so that all the Heavy and Tall person will be colored "blue" and rest as "red".

Use "`mycolors`" in the `col` argument of the plot function to mark the tall and heavy individuals

#### Plot all variables against each other

```{r, echo=ans, eval=ans}
pairs(bodydata, col = mycolors)
```
```{r, echo=!ans, eval=!ans}
pairs(bodydata)
```

#### Which variables seem to be most correlated to each other?
Here, `Weight` and `Circumference` seems to have highest correlation.

#### Which variables are least correlated to each other?
`Age` and `Height` variables seems to have least correlation.

Check by,

```{r}
cor(bodydata)
```

This returns the correlation matrix for the variables, and the guess made earlier true. Further, check out the help file for pairs, and the examples at the end. Try to make a pairs plot with scatter plots with smoothed lines in the lower left triangle, histograms on the diagonal, and correlation numbers in the upper right triangle.

Lets first create a function which create histogram. The function will later be used in the `pairs` function to create its diagonal plots.

```{r}
panel.hist <- function(x, ...) {
    usr <- par("usr"); on.exit(par(usr))
    par(usr = c(usr[1:2], 0, 1.5) )
    h <- hist(x, plot = FALSE)
    breaks <- h$breaks; nB <- length(breaks)
    y <- h$counts; y <- y/max(y)
    rect(breaks[-nB], 0, breaks[-1], y, col = "cyan", ...)
}
```

Now, create a function that will display correlation on `pairs` plot.

```{r}
panel.cor <- function(x, y, digits = 2, prefix = "", cex.cor, ...) {
    usr <- par("usr"); on.exit(par(usr))
    par(usr = c(0, 1, 0, 1))
    r <- abs(cor(x, y))
    txt <- format(c(r, 0.123456789), digits = digits)[1]
    txt <- paste0(prefix, txt)
    if (missing(cex.cor)) cex.cor <- 0.8 / strwidth(txt)
    text(0.5, 0.5, txt, cex = cex.cor * r)
}
```

Now, the above functions are implemented on the `pairs` plot,

```{r}
pairs(bodydata,
      lower.panel = panel.smooth, 
      upper.panel = panel.cor,
      diag.panel = panel.hist)
```

Here the `panel.smooth` deals with the smooth line on the lower panel of `pairs` plot.

#### Note:: Chapter 5 of the R book contains numerous examples of graphics.

```{r echo = FALSE}
detach(bodydata)
```
